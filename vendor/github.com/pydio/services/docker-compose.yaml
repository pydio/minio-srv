version: '3'
services:
    consul:
        image: consul:latest
        ports:
            - "8400:8400"
            - "8500:8500"
            - "53:53/udp"
            - "8301-8302/udp"
            - "8300-8300/tcp"
        networks: ["common"]
        environment:
            CONSUL_HTTP_ADDR: consul:8500
            CONSUL_CLIENT_INTERFACE: 'eth0'
            CONSUL_BIND_INTERFACE: 'eth0'

    mysql:
         image: mysql:latest
         environment:
             MYSQL_ROOT_PASSWORD: P@ssw0rd
             MYSQL_DATABASE: pydio
             MYSQL_USER: pydio
             MYSQL_PASSWORD: P@ssw0rd
         command: [mysqld, --character-set-server=utf8mb4, --collation-server=utf8mb4_unicode_ci]
         ports: ["3306:3306"]
         networks: ["common"]

    client:
        image: golang:1.8.3-alpine
        volumes:
            - ~/work/src:/src
        networks: ["common"]

    # gateway:
    #     image: golang:1.8.3-alpine
    #     volumes:
    #
    #         - ~/work/bin/linux_amd64:/bin/remote
    #         - ~/work/src:/src
    #     environment:
    #         PATH: /bin:/bin/remote:$PATH
    #         GOPATH: /
    #         CGO_ENABLED: 0
    #         MINIO_ACCESS_KEY: pydio
    #         MINIO_SECRET_KEY: pydiosecret
    #         CONSUL_HTTP_ADDR: consul:8500
    #     command: go run /src/github.com/pydio/minio-priv/main.go gateway pydio http://127.0.0.1:9000/source‚Äù
    #     ports:
    #         - "9020:9000"
    #     links:
    #         - consul
    #     depends_on:
    #         - config

    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        environment:
            - PMA_ARBITRARY=1
        networks: ["common"]
        ports:
            - 9080:80

    web:
        image: microhq/micro:latest
        command: --registry_address=consul:8500 --register_interval=5 --register_ttl=10 web
        networks: ["common"]
        depends_on:
            - consul
        ports:
            - "9081:8082"

    # gulp:
    #     image: golang:1.8.3-alpine
    #     environment:
    #         GOPATH: /
    #         CGO_ENABLED: 0
    #     volumes:
    #         - data-volume:/usr/lib/node_modules
    #         - bin-volume:/bin
    #         - ~/work/src:/src
    #     entrypoint: /src/github.com/pydio/services/watch/install.sh
    #     command: gulp server:watch

networks:
  common:
